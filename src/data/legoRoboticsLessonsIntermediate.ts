// LEGO Robotics Lessons - Intermediate Module (Lessons 5-8)
import { Lesson } from '@/types/lesson';

export const legoRoboticsLessonsIntermediate: Lesson[] = [
    {
        id: 'lego-lesson-5',
        number: 5,
        title: 'Работа с датчиками. Следование по линии',
        description: 'Цветовой датчик, гироскоп и P-регулятор для точной навигации',
        level: 'intermediate',
        duration: '65 мин',
        sections: [
            {
                id: 'color-sensor',
                title: 'Цветовой датчик',
                blocks: [
                    { type: 'heading', level: 3, content: 'Два режима работы' },
                    {
                        type: 'list', ordered: false, items: [
                            'Определение цвета — возвращает название (красный, синий...)',
                            'Отражённый свет — число от 0 (чёрный) до 100 (белый)'
                        ]
                    },
                    { type: 'note', variant: 'warning', content: 'Калибровка обязательна перед каждым заездом! Яркость света влияет на показания.' }
                ]
            },
            {
                id: 'zigzag',
                title: 'Алгоритм «Зигзаг»',
                blocks: [
                    { type: 'text', content: 'Робот «качается» над границей чёрного и белого.' },
                    { type: 'text', content: 'ЕСЛИ (свет < порог) → датчик над чёрным → повернуть вправо' },
                    { type: 'text', content: 'ИНАЧЕ → датчик над белым → повернуть влево' },
                    { type: 'note', variant: 'tip', content: 'Аналогия: Ведёте машину, держась за границу разметки. Наехали — поворачиваете в противоположную сторону.' }
                ]
            },
            {
                id: 'p-regulator',
                title: 'P-регулятор',
                blocks: [
                    { type: 'text', content: 'Сила поворота пропорциональна ошибке — насколько датчик уехал от границы.' },
                    { type: 'text', content: 'Ошибка = Целевое_Значение - Текущее_Значение (например, 50 - 100 = -50)' },
                    { type: 'text', content: 'Формула: Мощность = Базовая_Мощность + (Ошибка × Kp)' },
                    { type: 'note', variant: 'info', content: 'Начните с Kp = 0.5 и подбирайте экспериментально.' }
                ]
            },
            {
                id: 'gyro',
                title: 'Гироскоп',
                blocks: [
                    { type: 'text', content: 'Гироскоп измеряет угол поворота хаба в пространстве. Не зависит от пробуксовки колёс.' },
                    { type: 'note', variant: 'warning', content: 'Калибровка: Робот должен быть неподвижен 2 секунды после включения!' }
                ]
            }
        ],
        practicalTasks: [
            { type: 'task', title: 'Калибровщик', description: 'Программа, выводящая значения датчиков на экран хаба' },
            { type: 'task', title: 'Гонки по линии', description: 'Сравните «Зигзаг» и P-регулятор на извилистой трассе' },
            { type: 'task', title: 'Точный квадрат', description: 'Квадрат 50×50 см с поворотами по гироскопу' }
        ],
        quiz: [
            { id: 'lq5-1', question: 'Какой режим датчика цвета для следования по линии?', options: ['Определение цвета', 'Отражённый свет', 'Оба', 'Никакой'], correctAnswer: 1, explanation: 'Отражённый свет (0-100) позволяет точно определять границу чёрного и белого.' },
            { id: 'lq5-2', question: 'Что делает P-регулятор?', options: ['Ускоряет робота', 'Делает поворот пропорциональным ошибке', 'Останавливает на линии', 'Включает звук'], correctAnswer: 1, explanation: 'P-регулятор делает силу поворота пропорциональной отклонению от цели.' }
        ]
    },
    {
        id: 'lego-lesson-6',
        number: 6,
        title: 'Структурирование кода. My Blocks',
        description: 'Создание переиспользуемых блоков для чистого и эффективного кода',
        level: 'intermediate',
        duration: '55 мин',
        sections: [
            {
                id: 'spaghetti',
                title: 'Проблема спагетти-кода',
                blocks: [
                    { type: 'text', content: 'Длинная программа превращается в непонятную ленту блоков.' },
                    {
                        type: 'list', ordered: false, items: [
                            'Невозможно найти нужный участок',
                            'Изменение требует правки во всех похожих местах',
                            'Сложно объяснить логику судьям'
                        ]
                    }
                ]
            },
            {
                id: 'my-blocks',
                title: 'Что такое My Block?',
                blocks: [
                    { type: 'text', content: 'My Block — пользовательская команда, инкапсулирующая последовательность блоков.' },
                    { type: 'note', variant: 'tip', content: 'Аналогия: «Педаль газа» — My Block. Вы знаете, что делает (едет), но не думаете о внутреннем устройстве.' },
                    { type: 'heading', level: 3, content: 'Преимущества' },
                    {
                        type: 'list', ordered: false, items: [
                            'Читаемость: Вместо 20 блоков — один с понятным названием',
                            'Повторное использование: Создаётся один раз, используется много раз',
                            'Упрощение отладки: Правите код в одном месте'
                        ]
                    }
                ]
            },
            {
                id: 'create-block',
                title: 'Создание My Block',
                blocks: [
                    {
                        type: 'list', ordered: true, items: [
                            'Выделите группу блоков с логической функцией',
                            'Выберите «Создать My Block» в меню',
                            'Дайте понятное имя (TurnRight90Gyro)',
                            'Определите входные параметры (distance_cm, speed)',
                            'Нажмите «Готово»'
                        ]
                    }
                ]
            },
            {
                id: 'parametrization',
                title: 'Параметризация блоков',
                blocks: [
                    { type: 'text', content: 'Блок, поворачивающий на ЛЮБОЙ угол, полезен в 100 раз больше, чем только на 90°.' },
                    { type: 'text', content: 'Пример: TurnAngle(90) или TurnAngle(-45) для поворота в другую сторону.' }
                ]
            }
        ],
        practicalTasks: [
            { type: 'task', title: 'Фабрика блоков', description: 'Создайте DriveCM и Turn90, перепишите программу квадрата' },
            { type: 'task', title: 'Библиотека навигации', description: 'Создайте 5 универсальных блоков: DriveCM, TurnGyro, DriveUntilLine, AlignToLine, FollowLineTime' }
        ],
        quiz: [
            { id: 'lq6-1', question: 'Зачем нужны My Blocks?', options: ['Для красоты', 'Для читаемости и переиспользования', 'Для ускорения', 'Не нужны'], correctAnswer: 1, explanation: 'My Blocks делают код читаемым, переиспользуемым и упрощают отладку.' },
            { id: 'lq6-2', question: 'Что такое параметризация?', options: ['Удаление блоков', 'Добавление входных параметров', 'Копирование блоков', 'Удаление комментариев'], correctAnswer: 1, explanation: 'Параметризация — добавление входных параметров для универсальности блока.' }
        ]
    },
    {
        id: 'lego-lesson-7',
        number: 7,
        title: 'Стратегия и отладка',
        description: 'Планирование заезда, анализ ошибок и инструменты отладки',
        level: 'intermediate',
        duration: '60 мин',
        sections: [
            {
                id: 'strategy',
                title: 'От программы к стратегии',
                blocks: [
                    { type: 'text', content: 'Стратегия — план, какие миссии выполнять за 2,5-минутный заезд.' },
                    { type: 'heading', level: 3, content: 'Ключевые вопросы' },
                    {
                        type: 'list', ordered: false, items: [
                            'Последовательность: С каких миссий начать?',
                            'Группировка: Какие миссии рядом для одного выезда?',
                            'Надёжность vs Риск: Включать ли сложную миссию?'
                        ]
                    },
                    { type: 'note', variant: 'tip', content: 'Аналогия: Планирование похода в супермаркет. Список, группировка по отделам, последовательность.' }
                ]
            },
            {
                id: 'planning-tools',
                title: 'Инструменты планирования',
                blocks: [
                    {
                        type: 'list', ordered: false, items: [
                            'Физическая карта: Рисуйте траектории маркером',
                            'Таймлайн: Линия от 0 до 150 секунд с блоками-выездами'
                        ]
                    }
                ]
            },
            {
                id: 'error-analysis',
                title: 'Системный анализ ошибок',
                blocks: [
                    { type: 'heading', level: 3, content: 'Чек-лист причин провала' },
                    {
                        type: 'list', ordered: false, items: [
                            'Механика: Колесо прокрутилось? Манипулятор зацепился?',
                            'Сенсоры: Откалиброваны? Порог правильный?',
                            'Программа: Правильные числа? Ошибка в логике?',
                            'Окружение: Поле потёрлось? Освещение изменилось?'
                        ]
                    }
                ]
            },
            {
                id: 'debug-tools',
                title: 'Инструменты отладки',
                blocks: [
                    {
                        type: 'list', ordered: false, items: [
                            'Вывод на экран хаба: Значения датчиков, счётчики',
                            'Звуковая/световая отладка: Уникальные сигналы в разных ветках',
                            'Метод половинного деления: Сигнал в середине программы для локализации'
                        ]
                    }
                ]
            }
        ],
        practicalTasks: [
            { type: 'task', title: 'Карта стратега', description: 'Разработайте консервативную и агрессивную стратегии' },
            { type: 'task', title: 'Расследование', description: '10 тестов с протоколом, найдите коренную причину сбоев' }
        ],
        quiz: [
            { id: 'lq7-1', question: 'Что такое стратегия заезда?', options: ['Код программы', 'План миссий за 2,5 минуты', 'Настройка робота', 'Калибровка датчиков'], correctAnswer: 1, explanation: 'Стратегия — план, какие миссии и в каком порядке выполнять за заезд.' },
            { id: 'lq7-2', question: 'Зачем метод половинного деления?', options: ['Для ускорения', 'Для локализации ошибки', 'Для экономии батареи', 'Для красоты кода'], correctAnswer: 1, explanation: 'Метод позволяет быстро найти, в какой половине программы ошибка.' }
        ]
    },
    {
        id: 'lego-lesson-8',
        number: 8,
        title: 'Программирование для стабильности',
        description: 'Устойчивость к погрешностям: обратная связь и выравнивание',
        level: 'intermediate',
        duration: '60 мин',
        sections: [
            {
                id: 'uncertainty',
                title: 'Факторы неопределённости',
                blocks: [
                    {
                        type: 'list', ordered: false, items: [
                            'Заряд батареи: На полной мощнее',
                            'Трение: Новое поле скользкое, старое — цепкое',
                            'Люфт в механике: Появляется со временем',
                            'Неровная поверхность'
                        ]
                    },
                    { type: 'note', variant: 'warning', content: 'Нельзя полагаться только на расчёты. Нужна обратная связь!' }
                ]
            },
            {
                id: 'sensor-driven',
                title: '«Движение до сенсора» вместо «на расстояние»',
                blocks: [
                    { type: 'text', content: 'Замените открытый цикл (проехать 1000°) на замкнутый (ехать до датчика).' },
                    {
                        type: 'list', ordered: false, items: [
                            'Выезд до линии: Ехать, пока датчик не увидит чёрное',
                            'Подъезд к стене: Ехать, пока датчик расстояния < 5 см'
                        ]
                    },
                    { type: 'note', variant: 'tip', content: 'Робот всегда остановится в одной точке относительно линии или стены.' }
                ]
            },
            {
                id: 'alignment',
                title: 'Выравнивание по двум датчикам',
                blocks: [
                    {
                        type: 'list', ordered: true, items: [
                            'Робот медленно движется вперёд',
                            'Левый датчик видит линию → левый мотор стоп',
                            'Продолжает правым, пока правый не увидит',
                            'Оба на линии → ось параллельна линии'
                        ]
                    },
                    { type: 'note', variant: 'tip', content: 'Аналогия: Парковка по разметке. Смотрите в зеркала, а не на спидометр.' }
                ]
            },
            {
                id: 'failsafe',
                title: 'Подстраховки',
                blocks: [
                    { type: 'text', content: 'Двойное условие: Ехать пока (датчик не чёрный) И (градусы < 2000)' },
                    { type: 'text', content: 'Коррекция после поворота: Выравнивание по ближайшей линии.' }
                ]
            }
        ],
        practicalTasks: [
            { type: 'task', title: 'Открытый vs замкнутый цикл', description: 'Сравните точность двух подходов при смещении старта' },
            { type: 'task', title: 'Робот-нивелировщик', description: 'Реализуйте AlignToLine с двумя датчиками' }
        ],
        quiz: [
            { id: 'lq8-1', question: 'Почему «ехать до линии» надёжнее «проехать 50 см»?', options: ['Быстрее', 'Не зависит от пробуксовки', 'Красивее код', 'Экономит батарею'], correctAnswer: 1, explanation: 'Датчик гарантирует остановку в нужной точке независимо от проскальзывания.' },
            { id: 'lq8-2', question: 'Зачем нужно выравнивание по двум датчикам?', options: ['Для скорости', 'Для параллельности оси линии', 'Для экономии', 'Не нужно'], correctAnswer: 1, explanation: 'Выравнивание гарантирует, что ось робота параллельна линии.' }
        ]
    }
];
